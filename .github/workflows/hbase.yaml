#
#  Author: Hari Sekhon
#  Date: Tue Feb 4 09:53:28 2020 +0000
#
#  vim:ts=2:sts=2:sw=2:et
#
#  https://github.com/HariSekhon/Nagios-Plugins
#
#  If you're using my code you're welcome to connect with me on LinkedIn and optionally send me feedback
#
#  https://www.linkedin.com/in/HariSekhon
#

---
name: CI HBase

on:  # yamllint disable-line rule:truthy
  push:
    branches:
      - master
      - main
    paths:
      - '**/*hbase*'
  schedule:
    - cron: '0 10 * * *'

jobs:
  build:
    #name: build
    timeout-minutes: 180
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: pip-${{ runner.os }}-${{ runner.arch }}  # -${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            pip-${{ runner.os }}-${{ runner.arch }}
      - uses: actions/cache@v1
        with:
          path: ~/.cpanm
          key: cpanm-${{ runner.os }}-${{ runner.arch }}  # -${{ hashFiles('**/cpan-requirements.txt') }}
          restore-keys: |
            cpanm-${{ runner.os }}-${{ runner.arch }}
      - name: build
        run: make
      - name: zookeeper
        run: make zookeeper
      - name: test hbase
        run: HBASE_IMAGE=hbase tests/test_hbase.sh
      - name: test hbase dev
        run: tests/test_hbase.sh
